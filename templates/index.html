<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>지하철 혼잡도 조회 & CRUD</title>
</head>
<body>

<h1>지하철 혼잡도 조회 & CRUD</h1>

<!-- flash 메시지 출력 -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>
      {% for msg in messages %}
        <li>{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- 조회 폼 -->
<form method="POST">
    <label for="station">역 선택:</label>
    <select name="station" id="station" required>
        {% for s in stations %}
            <option value="{{ s['station_id'] }}">{{ s['station_name'] }}</option>
        {% endfor %}
    </select>

    <label for="time_slot">시간대 선택:</label>
    <select name="time_slot" id="time_slot" required>
        {% for t in time_slots %}
            <option value="{{ t }}">{{ t }}</option>
        {% endfor %}
    </select>

    <label for="day_type">요일 선택:</label>
    <select name="day_type" id="day_type">
        <option value="평일">평일</option>
        <option value="토요일">토요일</option>
        <option value="일요일">일요일</option>
    </select>

    <label for="direction">방향 선택:</label>
    <select name="direction" id="direction">
        <option value="상선">상선</option>
        <option value="하선">하선</option>
    </select>

    <button type="submit">조회</button>
</form>

<!-- 조회 결과 -->
{% if result %}
    <h2>
        {{ result.station_name }} ({{ result.day_type }}) {{ result.time_slot }} {{ result.direction }}
        혼잡도
        {% if result.congestion_level is not none %}
            {{ result.congestion_level }}%
        {% else %}
            데이터 없음
        {% endif %}
    </h2>
{% endif %}

<hr>

<!--Create: 추가-->
<h2>새로운 역 및 혼잡도 추가</h2>
<form method="POST" action="/add_station">
    <label>역 이름: <input type="text" name="new_station_name" required></label>
    <label>호선: <input type="number" name="new_line" required></label>
    <label>역 번호: <input type="text" name="new_station_number" required></label>

    <label>요일:
      <select name="new_day_type">
        <option value="평일">평일</option>
        <option value="토요일">토요일</option>
        <option value="일요일">일요일</option>
      </select>
    </label>

    <label>방향:
      <select name="new_direction">
        <option value="상선">상선</option>
        <option value="하선">하선</option>
      </select>
    </label>

    <div>
      {% for t in time_slots %}
        <label>{{ t }}: <input type="number" name="time_{{ t }}" min="0" max="100"></label>
      {% endfor %}
    </div>

    <button type="submit">추가</button>
</form>

<hr>

<!-- Update: 역 수정-->
<h2>역 정보 수정</h2>
<form method="POST" action="/update_station">
    <label for="upd_station">수정할 역 선택:</label>
    <select name="upd_station" id="upd_station" required>
        <option value="">--선택--</option>
        {% for s in stations %}
            <option value="{{ s['station_id'] }}">{{ s['station_name'] }}</option>
        {% endfor %}
    </select>

    <div>
        <label>새 역 이름: <input type="text" name="upd_station_name"></label>
        <label>새 호선: <input type="number" name="upd_line" min="1"></label>
        <label>새 역 번호: <input type="text" name="upd_station_number"></label>
    </div>

    <button type="submit">역 수정</button>
</form>

<hr>

<!-- Update: 혼잡도 수정-->
<h2>혼잡도 값 수정</h2>
<form method="POST" action="/update_congestion">
    <label for="upd_station2">역 선택:</label>
    <select name="upd_station2" id="upd_station2" required>
        <option value="">--선택--</option>
        {% for s in stations %}
            <option value="{{ s['station_id'] }}">{{ s['station_name'] }}</option>
        {% endfor %}
    </select>

    <label for="upd_time">시간대 선택:</label>
    <select name="upd_time" id="upd_time" required>
        {% for t in time_slots %}
            <option value="{{ t }}">{{ t }}</option>
        {% endfor %}
    </select>

    <label for="upd_day_type">요일:</label>
    <select name="upd_day_type" id="upd_day_type">
        <option value="평일">평일</option>
        <option value="토요일">토요일</option>
        <option value="일요일">일요일</option>
    </select>

    <label for="upd_direction">방향:</label>
    <select name="upd_direction" id="upd_direction">
        <option value="상선">상선</option>
        <option value="하선">하선</option>
    </select>

    <div>
        <label>새 혼잡도 값 (비우면 NULL): <input type="text" name="upd_value" placeholder="예: 45"></label>
    </div>

    <button type="submit">혼잡도 수정</button>
</form>

<hr>

<!-- Delete: 삭제 -->
<h2>삭제 기능</h2>

<form method="POST" action="/delete_station">
    <label>삭제할 역:
      <select name="del_station" required>
        {% for s in stations %}
          <option value="{{ s['station_id'] }}">{{ s['station_name'] }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">역 전체 삭제</button>
</form>

<br>

<form method="POST" action="/delete_congestion">
    <label>역:
      <select name="del_station" required>
        {% for s in stations %}
          <option value="{{ s['station_id'] }}">{{ s['station_name'] }}</option>
        {% endfor %}
      </select>
    </label>

    <label>시간:
      <select name="del_time" required>
        {% for t in time_slots %}
          <option value="{{ t }}">{{ t }}</option>
        {% endfor %}
      </select>
    </label>

    <label>요일:
      <select name="del_day_type">
        <option value="평일">평일</option>
        <option value="토요일">토요일</option>
        <option value="일요일">일요일</option>
      </select>
    </label>

    <label>방향:
      <select name="del_direction">
        <option value="상선">상선</option>
        <option value="하선">하선</option>
      </select>
    </label>

    <button type="submit">혼잡도 삭제</button>
</form>

</body>
</html>
