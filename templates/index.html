<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>지하철 혼잡도 시스템 (CRUD + Reset)</title>
    <style>
      body { font-family: Arial, sans-serif; line-height: 1.4; padding: 16px; }
      label { margin-right: 8px; }
      form { margin-bottom: 16px; }
      hr { margin: 18px 0; }
      .flash { background:#fffbdd; border:1px solid #ffd24d; padding:8px; margin-bottom:12px; }
      .section { padding:8px; border:1px solid #eee; margin-bottom:12px; border-radius:6px; }
    </style>
</head>
<body>

<h1>지하철 혼잡도 조회 & 관리 (CRUD)</h1>

<!-- flash 메시지 -->
{% with msgs = get_flashed_messages() %}
  {% if msgs %}
    <div class="flash">
      <ul>
        {% for m in msgs %}
          <li>{{ m }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
{% endwith %}

<!-- READ-->
<div class="section">
  <h2>조회</h2>
  <form method="POST">
      <label>역:
        <select name="station" required>
            {% for s in stations %}
                <option value="{{ s.station_id }}">{{ s.station_name }}</option>
            {% endfor %}
        </select>
      </label>

      <label>요일:
        <select name="day_type">
            <option value="평일">평일</option>
            <option value="토요일">토요일</option>
            <option value="일요일">일요일</option>
        </select>
      </label>

      <label>시간:
        <select name="time_slot" required>
            {% for t in time_slots %}
                <option value="{{ t }}">{{ t }}</option>
            {% endfor %}
        </select>
      </label>

      <label>방향:
        <select name="direction">
            <option value="상선">상선</option>
            <option value="하선">하선</option>
        </select>
      </label>

      <button type="submit">조회</button>
  </form>

  {% if result %}
    <h3>결과:</h3>
    <p>
      {{ result.station_name }}
      {{ result.day_type }}
      {{ result.time_slot }}

      {% if result.direction == '상선' %}
        내선
      {% elif result.direction == '하선' %}
        외선
      {% endif %}

      - 혼잡도:
      {% if result.congestion_level is not none %}
        {{ result.congestion_level }}%
      {% else %}
        데이터 없음
      {% endif %}
    </p>
  {% endif %}
</div>

<hr>

<!-- CREATE-->
<div class="section">
  <h2>Create — 새로운 역 / 혼잡도 추가</h2>
  <form method="POST" action="/add_station">
    <label>역 이름: <input type="text" name="new_station_name" required></label>
    <label>호선: <input type="number" name="new_line" min="1" required></label>
    <label>역 번호: <input type="text" name="new_station_number" required></label>

    <label>요일:
      <select name="new_day_type">
        <option value="평일">평일</option>
        <option value="토요일">토요일</option>
        <option value="일요일">일요일</option>
      </select>
    </label>

    <label>방향:
      <select name="new_direction">
        <option value="상선">상선</option>
        <option value="하선">하선</option>
      </select>
    </label>

    <div style="margin-top:8px;">
      <strong>시간대별 혼잡도 (빈칸 → NULL)</strong><br>
      {% for t in time_slots %}
        <label style="display:inline-block; width:150px;">
          {{ t }}: <input type="number" name="time_{{ t }}" min="0" max="100">
        </label>
      {% endfor %}
    </div>

    <button type="submit">추가</button>
  </form>
</div>

<hr>

<!-- UPDATE-->
<div class="section">
  <h2>Update — 역 정보 수정</h2>
  <form method="POST" action="/update_station">
    <label>역:
      <select name="upd_station" required>
        {% for s in stations %}
          <option value="{{ s.station_id }}">{{ s.station_name }}</option>
        {% endfor %}
      </select>
    </label>

    <label>새 이름: <input type="text" name="upd_station_name"></label>
    <label>새 호선: <input type="number" name="upd_line"></label>
    <label>새 역번호: <input type="text" name="upd_station_number"></label>

    <button type="submit">역 정보 수정</button>
  </form>
</div>

<div class="section">
  <h2>Update — 혼잡도 수정</h2>
  <form method="POST" action="/update_congestion">
    <label>역:
      <select name="upd_station2" required>
        {% for s in stations %}
          <option value="{{ s.station_id }}">{{ s.station_name }}</option>
        {% endfor %}
      </select>
    </label>

    <label>시간:
      <select name="upd_time">
        {% for t in time_slots %}
          <option value="{{ t }}">{{ t }}</option>
        {% endfor %}
      </select>
    </label>

    <label>요일:
      <select name="upd_day_type">
        <option value="평일">평일</option>
        <option value="토요일">토요일</option>
        <option value="일요일">일요일</option>
      </select>
    </label>

    <label>방향:
      <select name="upd_direction">
        <option value="상선">상선</option>
        <option value="하선">하선</option>
      </select>
    </label>

    <label>새 값: <input type="number" name="upd_value"></label>

    <button type="submit">혼잡도 수정</button>
  </form>
</div>

<hr>

<!-- DELETE-->
<div class="section">
  <h2>Delete</h2>

  <form method="POST" action="/delete_station">
    <label>역:
      <select name="del_station">
        {% for s in stations %}
          <option value="{{ s.station_id }}">{{ s.station_name }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">역 삭제</button>
  </form>
</div>

<hr>

<!-- RESET-->
<div class="section">
  <h2 style="color:red;">관리자: CSV 원본 복구</h2>
  <form method="POST" action="/reset_db">
    <button type="submit">원본 CSV로 초기화</button>
  </form>
</div>

</body>
</html>
